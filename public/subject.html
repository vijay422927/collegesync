<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subject | CollegeSync</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    * { box-sizing: border-box; font-family: 'Roboto', sans-serif; margin: 0; padding: 0; }
    body { background: #121212; color: #fff; min-height: 100vh; padding: 20px; }
    header { text-align: center; margin-bottom: 30px; }
    header h1 { color: #00e5ff; }
    .tabs { display: flex; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { margin: 5px; padding: 10px 20px; cursor: pointer; border-radius: 8px; background: #1e1e1e; transition: 0.3s; }
    .tab.active { background: linear-gradient(90deg, #00e5ff, #00bfa5); color: #121212; }
    .tab:hover { transform: scale(1.05); }
    .content { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
    .card { background: #1e1e1e; border-radius: 12px; padding: 15px; width: 280px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); transition: transform 0.3s; }
    .card:hover { transform: translateY(-5px); }
    .card img { width: 100%; border-radius: 8px; margin-bottom: 10px; }
    .card a { text-decoration: none; color: #00e5ff; display: inline-block; margin-top: 10px; }
    .co-section { width: 100%; max-width: 800px; margin-bottom: 20px; }
    .co-title { background: #2a2a2a; padding: 10px; border-radius: 8px; cursor: pointer; margin-bottom: 5px; }
    .co-content { display: none; padding: 10px; background: #1e1e1e; border-radius: 8px; }
    .co-content p { margin-bottom: 8px; }
    iframe { width: 100%; height: 180px; border-radius: 8px; }
    @media(max-width: 600px){ .card { width: 100%; } }
</style>
</head>
<body>

<header>
    <h1 id="subjectName">Subject Name</h1>
</header>

<div class="tabs">
    <div class="tab active" data-tab="oldpapers">Old Papers</div>
    <div class="tab" data-tab="cos">COs</div>
    <div class="tab" data-tab="notes">Notes</div>
    <div class="tab" data-tab="videos">Videos</div>
    <div class="tab" data-tab="cheatsheet">Cheatsheet</div>
</div>

<div id="content" class="content"></div>

<script>
const subjectId = localStorage.getItem('subjectId');
const subjectName = localStorage.getItem('subjectName');
document.getElementById('subjectName').textContent = subjectName;

// Tabs functionality
const tabs = document.querySelectorAll('.tab');
tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        renderTab(tab.dataset.tab);
    });
});

// Fetch subject data
async function fetchSubject() {
    const token = localStorage.getItem('token');
    const res = await fetch(`http://localhost:3800/api/v1/sem/sems?id=${subjectId}`, {
        headers: { 'Authorization': `Bearer ${token}` }
    });
    const data = await res.json();
    return data.data;
}

// Render different tabs
async function renderTab(tab) {
    const contentDiv = document.getElementById('content');
    contentDiv.innerHTML = '';
    const subject = await fetchSubject();

    if(tab === 'oldpapers'){
        subject.oldpapers.forEach(paper => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<h3>Old Paper</h3><a href="${paper.quetion}" target="_blank">View PDF</a><br><a href="${paper.key}" target="_blank">Answer Key</a>`;
            contentDiv.appendChild(card);
        });
    } else if(tab === 'cos'){
        subject.cos.forEach(co => {
            const coDiv = document.createElement('div');
            coDiv.className = 'co-section';
            coDiv.innerHTML = `<div class="co-title">${co.co}</div><div class="co-content"></div>`;
            const coContent = coDiv.querySelector('.co-content');
            co.quetions.forEach(q => {
                const qDiv = document.createElement('div');
                qDiv.innerHTML = `<p><strong>Q (${q.difficulty}):</strong> ${q.quetion}</p>
                                  ${q.answer.map(a=>`<p>${a}</p>`).join('')}`;
                coContent.appendChild(qDiv);
            });
            coDiv.querySelector('.co-title').addEventListener('click', () => {
                coContent.style.display = coContent.style.display === 'block' ? 'none' : 'block';
            });
            contentDiv.appendChild(coDiv);
        });
    } else if(tab === 'notes'){
        subject.notes.forEach(note => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<h3>Note</h3><img src="${note}" alt="note image" onerror="this.src='https://via.placeholder.com/280x180'">`;
            contentDiv.appendChild(card);
        });
    } else if(tab === 'videos'){
        subject.videos.forEach(video => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<iframe src="${video.replace("watch?v=","embed/")}" frameborder="0" allowfullscreen></iframe>`;
            contentDiv.appendChild(card);
        });
    } else if(tab === 'cheatsheet'){
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3>Cheatsheet</h3><a href="${subject.cheatsheet}" target="_blank">Download PDF</a>`;
        contentDiv.appendChild(card);
    }
}

// Render default tab
renderTab('oldpapers');
</script>

</body>
</html>
