<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | CollegeSync</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        background: #000;
        color: #fff;
    }

    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        background: #1e1e1e;
    }

    .navbar h1 {
        color: #00e5ff;
        margin: 0;
    }

    .buttons {
        display: flex;
        gap: 10px;
    }

    .buttons button {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(90deg, #00e5ff, #00bfa5);
        color: #121212;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }

    .buttons button:hover {
        background: linear-gradient(90deg, #00bfa5, #00e5ff);
    }

    .filter {
        text-align: center;
        margin: 20px 0;
    }

    .filter button {
        margin: 0 5px;
        padding: 8px 16px;
        border-radius: 8px;
        border: 2px solid #00e5ff;
        background: none;
        color: #00e5ff;
        cursor: pointer;
        transition: 0.3s;
    }

    .filter button.active, .filter button:hover {
        background: #00e5ff;
        color: #121212;
    }

    .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        padding: 0 40px 40px 40px;
    }

    .card {
        background: #1e1e1e;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        transition: transform 0.3s, box-shadow 0.3s;
        height: 260px;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.7);
    }

    .card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
    }

    .card-content {
        padding: 15px;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .card h3 {
        margin: 0 0 10px 0;
        font-size: 18px;
        color: #00e5ff;
        text-align: center;
    }

    .card button {
        border: none;
        border-radius: 8px;
        padding: 8px;
        background: linear-gradient(90deg, #00e5ff, #00bfa5);
        color: #121212;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        width: 100%;
    }

    .card button:hover {
        background: linear-gradient(90deg, #00bfa5, #00e5ff);
    }

    @media(max-width: 500px){
        .cards {
            padding: 0 20px 20px 20px;
        }
    }
</style>
</head>
<body>

<div class="navbar">
    <h1>CollegeSync</h1>
    <div class="buttons">
        <button onclick="alert('Time Table clicked')">Time Table</button>
        <button onclick="alert('Attendance clicked')">Attendance</button>
    </div>
</div>

<div class="filter">
    <button class="active" onclick="filterSem('all')">All</button>
    <button onclick="filterSem('3-1')">3-1</button>
    <button onclick="filterSem('3-2')">3-2</button>
</div>

<div class="cards" id="cardsContainer"></div>

<script>
    const token = localStorage.getItem('token'); 
    let allSubjects = [];

    const subjectImages = {
        "OS": "https://tse1.mm.bing.net/th/id/OIP.dCaLiNJNwwsC4-dUIDZrHwHaDh?pid=Api&P=0&h=180",
        "DBMS": "https://tse2.mm.bing.net/th/id/OIP.zkbyXAD5EgU5yQbPfstVlAHaEK?pid=Api&P=0&h=180"
    };

    async function fetchSubjects() {
        try {
            const res = await fetch('http://localhost:3800/api/v1/sem/sem', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            const data = await res.json();
            if(res.ok){
                allSubjects = data.data.result;
                renderCards(allSubjects);
            } else {
                alert(data.message || 'Failed to fetch subjects');
            }
        } catch (err) {
            console.error(err);
            alert('Server error');
        }
    }

    function renderCards(subjects){
        const container = document.getElementById('cardsContainer');
        container.innerHTML = '';

        subjects.forEach(semItem => {
            semItem.subjects.forEach(subject => {
                const card = document.createElement('div');
                card.classList.add('card');

                const imgUrl = subjectImages[subject.name] || `https://source.unsplash.com/400x200/?study,book,${subject.name}`;

                card.innerHTML = `
                    <img src="${imgUrl}" alt="${subject.name}">
                    <div class="card-content">
                        <h3>${subject.name} (${semItem.sem})</h3>
                        <button onclick="exploreSubject('${subject.id}', '${subject.name}')">Explore</button>
                    </div>
                `;
                container.appendChild(card);
            });
        });
    }

    function exploreSubject(subjectId, subjectName){
        localStorage.setItem('subjectId', subjectId);
        localStorage.setItem('subjectName', subjectName);
        window.location.href = 'subject.html';
    }

    function filterSem(sem){
        document.querySelectorAll('.filter button').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.filter button[onclick="filterSem('${sem}')"]`).classList.add('active');

        if(sem === 'all'){
            renderCards(allSubjects);
        } else {
            const filtered = allSubjects.filter(s => s.sem === sem);
            renderCards(filtered);
        }
    }

    fetchSubjects();
</script>

</body>
</html>
